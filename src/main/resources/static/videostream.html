<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MongoDB GridFS ì˜ìƒ ì—…ë¡œë“œ & ìŠ¤íŠ¸ë¦¬ë°</title>
</head>
<body>
<h2>MongoDB GridFS ì˜ìƒ ì—…ë¡œë“œ</h2>

<input type="file" id="videoInput">
<button onclick="uploadVideo()">ì—…ë¡œë“œ</button>
<p id="uploadStatus"></p>

<h2>MongoDB GridFS ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë°</h2>
<input type="text" id="videoIdInput" placeholder="ObjectId ì…ë ¥">
<button onclick="loadVideo()">ì˜ìƒ ë¶ˆëŸ¬ì˜¤ê¸°</button>

<h3>ğŸ¥ ì˜ìƒ ë¯¸ë¦¬ë³´ê¸°</h3>
<video id="videoPlayer" width="640" controls>
  <source id="videoSource" src="" type="video/mp4">
  ë¸Œë¼ìš°ì €ê°€ ë¹„ë””ì˜¤ íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
</video>

<script>
  async function uploadVideo() {
      const fileInput = document.getElementById("videoInput");
      const uploadStatus = document.getElementById("uploadStatus");

      if (!fileInput.files.length) {
          uploadStatus.textContent = "âŒ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!";
          return;
      }

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append("file", file);

      try {
          const response = await fetch("http://localhost:8080/video/upload", {
              method: "POST",
              body: formData
          });

          if (!response.ok) {
              throw new Error("ì—…ë¡œë“œ ì‹¤íŒ¨");
          }

          const videoId = await response.text();
          uploadStatus.textContent = `âœ… ì—…ë¡œë“œ ì„±ê³µ! ì˜ìƒ ID: ${videoId}`;
      } catch (error) {
          console.error("ì˜ìƒ ì—…ë¡œë“œ ì˜¤ë¥˜:", error);
          uploadStatus.textContent = "âŒ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ!";
      }
  }

  function loadVideo() {
      const videoId = document.getElementById("videoIdInput").value;
      const videoSource = document.getElementById("videoSource");
      const videoPlayer = document.getElementById("videoPlayer");

      if (!videoId) {
          alert("ì˜ìƒ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
          return;
      }

      videoSource.src = `http://localhost:8080/designers/stream?objectId=67aed091c61dc36612fb5f20`;
      videoPlayer.load(); // ë¹„ë””ì˜¤ ìƒˆë¡œê³ ì¹¨
  }
</script>
</body>
</html>